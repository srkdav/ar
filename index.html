<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Chart in AR.js</title>
  <!-- Latest A-Frame -->
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <!-- AR.js -->
  <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
  <script>
    // Disable unused GLTF loader to prevent DRACO conflicts
    AFRAME.registerComponent('gltf-model', { init: () => {} });
  </script>
</head>
<body>
  <a-scene embedded arjs>
    <!-- Marker -->
    <a-marker preset="custom" type="pattern" url="marker.patt">
      <!-- Container for the 3D chart -->
      <a-entity id="chart-container" position="0 0 0"></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <!-- Inline JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Get the 3D chart container
      const chartContainer = document.querySelector("#chart-container").object3D;

      // Create a Three.js Scene for the 3D chart
      const scene = new THREE.Scene();

      // Create material for lines (axes)
      const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });

      // Sample Data: Region, Sales, and Revenue
      const dataPoints = [
        { region: "India", x: 10, y: 500, z: 1, color: 0xff0000 }, // Sales in M$, Revenue in M$
        { region: "US", x: 200, y: 800, z: 2, color: 0x00ff00 },
        { region: "UK", x: 50, y: 300, z: 3, color: 0x0000ff },
        { region: "Germany", x: 100, y: 600, z: 4, color: 0xffff00 },
      ];

      // Smaller scale factor for normalization
      const scaleFactor = 0.005; // Reduced scaling for a smaller graph
      const normalizedData = dataPoints.map((point) => ({
        ...point,
        x: point.x * scaleFactor,
        y: point.y * scaleFactor,
        z: point.z * scaleFactor,
      }));

      // Add each data point as a sphere
      normalizedData.forEach((point) => {
        const sphereGeometry = new THREE.SphereGeometry(0.05, 16, 16); // Smaller sphere
        const sphereMaterial = new THREE.MeshBasicMaterial({ color: point.color });
        const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
        sphere.position.set(point.x, point.y, point.z); // Position based on x, y, z
        scene.add(sphere);

        // Add labels for each data point
        const label = document.createElement("a-text");
        label.setAttribute("value", `${point.region}\nSales: ${point.x / scaleFactor}M$\nRevenue: ${point.y / scaleFactor}M$`);
        label.setAttribute("color", "white");
        label.setAttribute("side", "double");
        label.setAttribute("align", "center");
        label.setAttribute("scale", "0.3 0.3 0.3"); // Scale down labels
        label.setAttribute("position", `${point.x} ${point.y + 0.1} ${point.z}`);
        document.querySelector("a-marker").appendChild(label);
      });

      // Create smaller X, Y, Z axes
      const axesPoints = [
        // X-axis (Sales)
        new THREE.Vector3(0, 0, 0),
        new THREE.Vector3(1, 0, 0), // Shortened length
        // Y-axis (Revenue)
        new THREE.Vector3(0, 0, 0),
        new THREE.Vector3(0, 1, 0), // Shortened length
        // Z-axis (Region)
        new THREE.Vector3(0, 0, 0),
        new THREE.Vector3(0, 0, 1), // Shortened length
      ];

      const axesGeometry = new THREE.BufferGeometry().setFromPoints(axesPoints);
      const axes = new THREE.LineSegments(axesGeometry, lineMaterial);
      scene.add(axes);

      // Attach the Three.js scene to the A-Frame chart container
      chartContainer.add(scene);

      // Add axis labels using A-Frame text
      const labels = [
        { text: "Sales (M$)", position: [1.2, 0, 0] },
        { text: "Revenue (M$)", position: [0, 1.2, 0] },
        { text: "Region", position: [0, 0, 1.2] },
      ];

      labels.forEach((label) => {
        const text = document.createElement("a-text");
        text.setAttribute("value", label.text);
        text.setAttribute("color", "white");
        text.setAttribute("side", "double");
        text.setAttribute("scale", "0.3 0.3 0.3"); // Scale down labels
        text.setAttribute("position", label.position.join(" "));
        document.querySelector("a-marker").appendChild(text);
      });
    });
  </script>
</body>
</html>
